services:
  portfolio-api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: portfolio-api
    restart: unless-stopped
    ports:
      - "3002:3002"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - BETTER_AUTH_SECRET=${BETTER_AUTH_SECRET}
      - N8N_WEBHOOK_URL=${N8N_WEBHOOK_URL}
      - CORS_ORIGIN=${CORS_ORIGIN}
      - PORT=3002
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.portfolio-api.rule=Host(`portfolio.harisidham.com`)"
      - "traefik.http.routers.portfolio-api.entrypoints=websecure"
      - "traefik.http.routers.portfolio-api.tls.certresolver=letsencrypt"
      - "traefik.http.services.portfolio-api.loadbalancer.server.port=3002"
    networks:
      - dokploy-network
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:3002/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  dokploy-network:
    external: true
